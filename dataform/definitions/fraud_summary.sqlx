config {
  type: "table",
  tags: ["reporting"]
}

select
  type,
  count(*) as total_tx,
  sum(amount) as total_amount,
  sum(case when isFraud = 1 then 1 else 0 end) as fraud_tx,
  sum(case when isFraud = 1 then amount else 0 end) as fraud_amount,
  safe_divide(sum(case when isFraud = 1 then 1 else 0 end), count(*)) as fraud_rate
from
  ${ref("transactions_clean")}
group by
  type
