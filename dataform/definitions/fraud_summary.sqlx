config {
  type: "table",
  description: "Daily fraud metrics"
}

SELECT
  CURRENT_TIMESTAMP() AS generated_at,
  type,
  COUNT(*) AS total_txns,
  COUNTIF(isFraud = 1) AS fraud_txns,
  ROUND(100 * COUNTIF(isFraud = 1) / COUNT(*), 2) AS fraud_rate
FROM
  ${ref("transactions_clean")}
GROUP BY type
